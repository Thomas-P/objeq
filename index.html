<html>
<head>
  <title>Objeq Query Language Tester</title>
  <script type="text/javascript" src="objeq-parser.js"></script>
  <script type="text/javascript" src="objeq.js"></script>
  <script type="text/javascript">
    function performQuery() {
      var source = JSON.parse(document.getElementById('source').value);
      var data = $objeq(source);
      var query = document.getElementById('query').value;

      // The actual query
      var start = new Date().getTime();
      var result = data.snapshot(query);
      var elapsed = new Date().getTime() - start;
      var stats = "(" + result.length + " items in " + elapsed + "ms)";
      document.getElementById('stats').innerText = stats;

      var output = JSON.stringify(result, function(key, value) {
        return key == '__objeq_id__' ? undefined : value;
      });
      document.getElementById('result').value = output;
    }

    function chooseQuery() {
      var value = document.getElementById('queries').value;
      document.getElementById('query').value = value;
      performQuery();
    }
  </script>
  <style>
    textarea {
      font-family: Courier New, Courier, serif;
      font-size: 16px;
    }
    body {
      padding: 0px; margin: 0px;
    }
    .query {
      position: absolute;
      left: 0px; top: 0px; right: 0px; height: 100px;
      margin: 0px;
      border-bottom: 1px solid gray;
    }
    #query {
      position: absolute;
      left: 70px; top: 10px;
      bottom: 30px; right: 90px;
      font-size: 20px;
    }
    #queries {
      position: absolute;
      left: 70px; bottom: 10px; right: 90px; height: 20px;
    }
    #run {
      position: absolute;
      right: 10px; width: 70px;
      top: 10px;
    }
    .label {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 16px;
      position: absolute;
      left: 10px; top: 10px;
    }
    .source {
      position: absolute;
      left: 0px; top: 100px; right: 50%; bottom: 30px;
      margin: 0px;
    }
    #source {
      position: absolute;
      left: 10px; top: 35px; right: 5px; bottom: 10px;
    }
    .result {
      position: absolute;
      left: 50%; top: 100px; right: 0px; bottom: 30px;
      margin: 0px;
    }
    #result {
      position: absolute;
      left: 5px; top: 35px; right: 10px; bottom: 10px;
    }
    .info {
      text-align: center;
      position: absolute;
      left: 10px; bottom: 10px; height: 20px; right: 10px;
      font-family: Arial, Helvetica, sans-serif;
      font-size: 16px;
    }
  </style>
</head>
<body onload="chooseQuery();">
  <div class="query">
    <div class="label">Query</div>
    <textarea id="query"></textarea>
    <button id="run" onclick="performQuery();">Query</button>
    <select id ="queries" onchange="chooseQuery();">
      <option selected>age > 20 order by firstName</option>
      <option>firstName == 'Thom' and age > 20</option>
      <option>order by lastName, firstName, age</option>
      <option>order by age, firstName select lastName</option>
    </select>
  </div>
  <div class="source">
    <div class="label">Source</div>
    <textarea id="source">
[
  { "firstName": "Bill", "lastName": "Bradley", "age": 30 },
  { "firstName": "Thom", "lastName": "Bradford", "age": 40 },
  { "firstName": "Stefano", "lastName": "Rago", "age": 29 },
  { "firstName": "Fred", "lastName": "Wilkinson", "age": 50 },
  { "firstName": "Ted", "lastName": "Williams", "age": 20 },
  { "firstName": "Jed", "lastName": "Clampet", "age": 70 },
  { "firstName": "Will", "lastName": "Robinson", "age": 45 },
  { "firstName": "John", "lastName": "Jacob", "age": 54 },
  { "firstName": "Thom", "lastName": "Smith", "age": 15 },
  { "firstName": "Bill", "lastName": "Blake", "age": 90 },
  { "firstName": "Hank", "lastName": "Williams", "age": 70 },
  { "firstName": "John", "lastName": "Cash", "age": 45 },
  { "firstName": "Joe", "lastName": "Strummer", "age": 54 },
  { "firstName": "Ted", "lastName": "Turner", "age": 15 }
]
    </textarea>
  </div>
  <div class="result">
    <div class="label">Result <span id="stats"></span></div>
    <textarea id="result" readonly="readonly"></textarea>
  </div>
  <div class="info">
    Demo of the Objeq Javascript Query Language -- Find us at Github:
    <a href="http://github.com/agilosoftware/objeq">
      http://github.com/agilosoftware/objeq
    </a>
  </div>
</body>
</html>
